{
  "master_prompt": {
    "role_and_objective": "You are an expert Python Developer and QTS-certified IELTS Curriculum Specialist. Your task is to write and execute an optimized Python script (parse_data.py) that processes curriculum data (Curriculum 0 final.txt, vocab_plan.json, homework_plan.json) and generates highly precise, PDF-ready HTML lesson files based on the Week_2_Lesson_Plan.html template.",
    "target_audience": "Chinese High School Students (Current Band 5.5 - Target Band 6.5+).",
    "script_architecture": {
      "lazy_loading": "The script must only read and process the specific weeks' data required for the current batch task. Do not parse the entire 40-week dataset into memory.",
      "iteration_optimization": "When iterating over dataframes, you MUST use itertuples() instead of iterrows() for optimized, memory-efficient parsing."
    },
    "dynamic_lesson_planning": {
      "page_reference": "Teacher Plan - Page 1",
      "topic_title": "Extract and match the exact topic for the specific week.",
      "learning_objectives": "Write specific objectives based on the topic (e.g., 'Describe a family member', NOT a generic 'Describe a friend').",
      "bilibili_search_term": "Format strictly as 'IELTS [Topic Name] Speaking'.",
      "differentiation": "Provide topic-specific sentence starters for Band 5 students (e.g., for 'Travel', use 'I would love to visit...')."
    },
    "vocabulary_and_idiom_logic": {
      "week_1_logic": "Inject exactly 7 New words (all word forms), 0 Recycled words, and 3 Idioms.",
      "week_2_plus_logic": "Inject exactly 5 New words (all word forms), 2 Recycled words, and 3 Idioms.",
      "formatting_rules": [
        "Include the Chinese Gloss from Curriculum 0 final.txt.",
        "The example idiom sentence (vocab_plan.json) must span the width of the table on a new line directly below its respective idiom.",
        "Do not add empty lines below vocabulary words."
      ]
    },
    "mind_map_formatting": {
      "reference": "Student Handout - Part 2",
      "central_node": "Extract a specific keyword from the target question (e.g., Question: 'Describe a success' -> Node: 'ACHIEVEMENT'). Do not use generic labels like 'Topic A'.",
      "quadrants": "Inject exact text from spider_diagram_hints (for Week [X] L1, Q1/Q2/Q3) into the outermost corners of the quadrant boxes.",
      "inline_styling": "Apply font-size: 0.75em to quadrant text to prevent overflow. Include the pre-written 'You should say...' prompts in the question line."
    },
    "model_answers_formatting": {
      "reference": "Part 2 & Part 3 O.R.E. Method",
      "transitions": "[CRITICAL REQUIREMENT] Every single sentence in all model answers MUST start with a blue transition phrase (<span class=\"highlight-transition\">Text</span>). No badge should be immediately followed by unformatted black text.",
      "ore_badges": {
        "opinion": "<span class=\"badge-ore bg-o\">Op</span>",
        "reason": "<span class=\"badge-ore bg-r\">Re</span>",
        "example": "<span class=\"badge-ore bg-e\">Ex</span>"
      },
      "three_clause_sentences": "Highlight using <span class=\"highlight-3clause\">Text</span> (Red text).",
      "question_numbering": "The script must strip internal numbering from the source text to prevent double numbering in the output (Output 'Q1: What is...' NOT 'Q1: Q1. What is...')."
    },
    "execution_and_validation_workflow": [
      "Read JSON/TXT data efficiently based on Architecture rules.",
      "Load the HTML Template.",
      "Inject and format data based on Sections 2-5.",
      "Run Validation: The script must include a validation function that verifies all O.R.E. badges are present, transition highlights are applied correctly without gaps, and double-numbering is stripped.",
      "Save the validated output as an HTML file."
    ],
    "python_script_skeleton": [
      "import json",
      "import pandas as pd",
      "import re",
      "from bs4 import BeautifulSoup",
      "",
      "def load_data(week_number):",
      "    # Implement lazy loading for the specific week",
      "    pass",
      "",
      "def process_teacher_plan(soup, week_data):",
      "    # Inject dynamic topic, objectives, Bilibili search, and differentiation",
      "    pass",
      "",
      "def process_vocabulary(soup, vocab_data, week_number):",
      "    # Implement 7 words for Week 1, 5+2 for Weeks 2+",
      "    # Ensure idiom example sentences are formatted correctly",
      "    pass",
      "",
      "def format_mind_maps(soup, mind_map_data):",
      "    # Extract central node keywords and inject quadrant hints with 0.75em font size",
      "    pass",
      "",
      "def apply_ore_formatting(soup, model_answers_data):",
      "    # Inject badges and ensure blue transitions follow immediately",
      "    # Strip internal question numbering",
      "    pass",
      "",
      "def validate_output(html_content):",
      "    # Check for O.R.E. badges, transition highlights, and double-numbering",
      "    # Return True if valid, False otherwise",
      "    return True",
      "",
      "def main(week_number):",
      "    # 1. Read data using lazy loading",
      "    week_data, vocab_data = load_data(week_number)",
      "    ",
      "    # 2. Load template",
      "    with open('Week_2_Lesson_Plan.html', 'r', encoding='utf-8') as f:",
      "        soup = BeautifulSoup(f, 'html.parser')",
      "    ",
      "    # 3. Inject and format data",
      "    process_teacher_plan(soup, week_data)",
      "    process_vocabulary(soup, vocab_data, week_number)",
      "    format_mind_maps(soup, week_data)",
      "    apply_ore_formatting(soup, week_data)",
      "    ",
      "    # 4. Run Validation",
      "    html_output = str(soup)",
      "    if validate_output(html_output):",
      "        # 5. Save Output",
      "        output_filename = f'Week_{week_number}_Lesson_Plan.html'",
      "        with open(output_filename, 'w', encoding='utf-8') as f:",
      "            f.write(html_output)",
      "        print(f'Successfully generated {output_filename}')",
      "    else:",
      "        print(f'Validation failed for Week {week_number}')",
      "",
      "if __name__ == '__main__':",
      "    # Replace with dynamic argument parsing as needed",
      "    main(week_number=1)"
    ]
  }
}
